# Private Link について

こんにちは、Azure Networking 担当の米川です！

最近、Private Link のご利用を検討いただいている方が増えてきているように思えますが、サービスエンドポイントとの違いや、プライベートエンドポイントと Private Link の関係、DNS の設定方法など、まだ慣れない部分が多いかと思います。

このブログでは、そういったポイントについて解説していこうと思います。

## Private Link は Private Endpoint と Private Link Service の総称
Private Link のドキュメントを読んでいただくと、プライベートエンドポイントだったり、プライベートリンクサービスだったり、
似たような言葉が多く並んでいるかと思います。

結論から言うと、**プライベートリンクは、プライベートエンドポイントとプライベートリンクサービスの総称**となります。

* Private Endpoint

   Azure PaaS サービスや、独自に作成した Private Link サービスに対してプライベートエンドポイント (プライベート IP アドレス) を提供するサービス

* Private Link サービス

    独自に作成したサービス (Standard Load Balancer の背後に存在するアプリケーション群) に対して、プライベートエンドポイントを作成できるようにするサービス


Private Link と Private Link サービスがあることで混乱しやすいですが、
Private Link (Private Endpoint 含む) と、Private Link サービスは、それぞれ異なる意味を持ちます。

ここでは、まず Private Endpoint について説明していきます。

## Private Endpoint により Azure パブリックサービスに対してプライベート IP アドレスでアクセスさせることが可能になります

従来、Azure パブリック サービス (PaaS サービス) はパブリック IP アドレスでのアクセスだけが可能でした。  
これをお客様のネットワークに閉じたい場合、App Service でいう App Service Environment など、PaaS サービス自体を仮想ネットワーク上に構築するような機能が必要です。  
しかし、ストレージアカウントなど、中にはそういった構成が出来ない PaaS サービスもあり、そういったサービスについてはプライベート IP 経由で通信することが出来ないため、PaaS サービス側のファイアウォールなどで最低限必要なパブリック IP アドレスを許可するような運用が必要でした。  
また、サービスエンドポイントを使用する構成もありますが、サービスエンドポイントを使用しても宛先 IP アドレスはパブリック IP アドレスのままなので、オンプレミス側から VPN 経由や ExpressRoute (Private Peering) 経由で接続できないという問題もあります。

そこで登場したのがプライベートエンドポイントです。

プライベートエンドポイントを作成すると、特定の PaaS サービスに対するプライベートエンドポイントが、
作成時に指定したサブネット内に作成されます。  
プライベートエンドポイントに対して、対象のサブネットからプライベート IP アドレスが払い出されるため、
ユーザーはそのプライベート IP アドレスに通信することで、対象の PaaS サービスに通信することが可能となります。  
勿論、VPN や ExpressRoute のプライベートピアリング経由でも通信することが可能になります。  
加えて、対象の PaaS サービスのファイアウォール設定で、特定のパブリック IP アドレスを許可する必要がなくなります。

<p><img src="./img/private-endpoint.png" alt="private-endpoint" /></p> 

